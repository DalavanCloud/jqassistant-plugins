apply plugin: 'java'
apply plugin: 'maven'

project.ext["jqaversion"] = "1.0.0-M4-SNAPSHOT"
project.group = 'de.kontext-e.jqassistant.plugin'
project.version = '1.0.0-M4-SNAPSHOT'

subprojects {
    apply plugin: 'java'
    apply plugin: 'maven'
    //apply plugin: 'pmd'

    version = project.jqaversion
    sourceCompatibility = 1.7

    repositories {
        mavenCentral()
        mavenLocal()
    }

    dependencies {
        compile 'com.buschmais.jqassistant.core:jqassistant.core.scanner:'+project.jqaversion
        compile 'com.buschmais.jqassistant.core:jqassistant.core.store:'+project.jqaversion
        compile 'com.buschmais.jqassistant.plugin:jqassistant.plugin.common:'+project.jqaversion
        testCompile group: 'junit', name: 'junit', version: '4.+'
    }


/*
    pmd {

      ruleSets = ["basic", "braces"]
    }
*/

    install {
        repositories.mavenInstaller {
            pom.groupId = 'de.kontext-e.jqassistant.plugin'
        }
    }
}

repositories {
  mavenLocal()
  mavenCentral()
}

dependencies {

  testRuntime("com.buschmais.jqassistant.core:jqassistant.core.store:1.0.0-M4-SNAPSHOT")
  testRuntime("com.buschmais.jqassistant.core:jqassistant.core.scanner:1.0.0-M4-SNAPSHOT")
  testRuntime("com.buschmais.jqassistant.core:jqassistant.core.analysis:1.0.0-M4-SNAPSHOT")
  testRuntime("com.buschmais.jqassistant.plugin:jqassistant.plugin.common:1.0.0-M4-SNAPSHOT")
  testRuntime("com.buschmais.jqassistant.scm:jqassistant.scm.cli:1.0.0-M4-SNAPSHOT")

  testRuntime("com.buschmais.jqassistant.plugin:jqassistant.plugin.cdi:1.0.0-M4-SNAPSHOT")
  testRuntime("com.buschmais.jqassistant.plugin:jqassistant.plugin.ejb3:1.0.0-M4-SNAPSHOT")
  testRuntime("com.buschmais.jqassistant.plugin:jqassistant.plugin.java:1.0.0-M4-SNAPSHOT")
  testRuntime("com.buschmais.jqassistant.plugin:jqassistant.plugin.java8:1.0.0-M4-SNAPSHOT")
  testRuntime("com.buschmais.jqassistant.plugin:jqassistant.plugin.javaee6:1.0.0-M4-SNAPSHOT")
  testRuntime("com.buschmais.jqassistant.plugin:jqassistant.plugin.jaxrs:1.0.0-M4-SNAPSHOT")
  testRuntime("com.buschmais.jqassistant.plugin:jqassistant.plugin.jpa2:1.0.0-M4-SNAPSHOT")
  testRuntime("com.buschmais.jqassistant.plugin:jqassistant.plugin.junit4:1.0.0-M4-SNAPSHOT")

  testRuntime("de.kontext-e.jqassistant.plugin:jqassistant.plugin.checkstyle:1.0.0-M4-SNAPSHOT")
  testRuntime("de.kontext-e.jqassistant.plugin:jqassistant.plugin.findbugs:1.0.0-M4-SNAPSHOT")
  testRuntime("de.kontext-e.jqassistant.plugin:jqassistant.plugin.jacoco:1.0.0-M4-SNAPSHOT")
  testRuntime("de.kontext-e.jqassistant.plugin:jqassistant.plugin.git:1.0.0-M4-SNAPSHOT")

  testRuntime("org.neo4j:neo4j:2.1.5")

  testRuntime 'com.sun.jersey:jersey-server:1.13'
  testRuntime 'com.sun.jersey:jersey-core:1.13'
  testRuntime 'com.sun.jersey:jersey-servlet:1.13'
}

task removeJQAReport(type: Delete) {
  delete 'jqassistant/report'
}

task(jqascan, dependsOn: 'removeJQAReport', type: JavaExec) {
  main = 'com.buschmais.jqassistant.scm.cli.Main'
  classpath = sourceSets.test.runtimeClasspath
  args 'scan'
  args '-f'
  args 'git/src/test/properties'
}

task(jqaanalyze, type: JavaExec) {
  main = 'com.buschmais.jqassistant.scm.cli.Main'
  classpath = sourceSets.test.runtimeClasspath
  args 'analyze'
  args '-r'
  args 'jqassistant'
}

task(jqa, dependsOn: ['jqascan','jqaanalyze']) {
  jqaanalyze.mustRunAfter jqascan
}

task(jqs, type: JavaExec) {
  main = 'com.buschmais.jqassistant.scm.cli.Main'
  classpath = sourceSets.test.runtimeClasspath
  args 'server'
}
